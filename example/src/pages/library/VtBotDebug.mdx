---
layout: src/layouts/LibraryMdxLayout.astro
title: Reusables
vtn: vtbotdebug-3
---
import { Picture } from 'astro:assets';
import VtBotDebug1_light from 'src/assets/VtBotDebug1.light.png';
import VtBotDebug1_dark from 'src/assets/VtBotDebug1.dark.png';

<h1 style="display: inline-block; view-trans 	ition-name: vtbotdebug-1"><span style="display:inline-block; view-transition-name:vtbotdebug-2">üêõ</span> Debug Component</h1>


The `<VtBotDebug/>` component logs the view transition events and their data. 


## Contents

## Why would I need this component

When View Transitions do not behave the way you expect and you need support in hunting down the bugs, the `<VtBotDebug/>` component can help you. 


### Example Output

During view transitions, the `<VtBotDebug>` component logs four types of information to the console:
* Astro's view transition events and their properties 
* Start and end of the execution of `loader()` and `swap()`
* The transition groups that participate in the transition
* The viewTransition promises `ready`, `updateCallbackDone` and `finished`, how they are resolved or rejected

You can see when events happen, what data they carry and when the data is altered by event handlers. Output for properties and transitions is collapsed by default.

```console x.txt {1,6,7,12,15}
   18:09:18.024 [vtbot-debug] Event handler for astro:before-preparation
‚Øà 18:09:18.025 [vtbot-debug] Properties of the astro:before-preparation event
   18:09:18.027 [vtbot-debug] before execution of loader()
   18:09:18.376 [vtbot-debug] newDocument changed from a1: v1 (18.24 kB) to a2: v2 (11.04 kB)
   18:09:18.376 [vtbot-debug] after execution of loader()
   18:09:18.376 [vtbot-debug] Event handler for astro:after-preparation
   18:09:18.403 [vtbot-debug] Event handler for astro:before-swap
‚Øà 18:09:18.404 [vtbot-debug] Properties of the astro:before-swap event
   18:09:18.407 [vtbot-debug] before execution of swap()
   18:09:18.411 [vtbot-debug] after execution of swap()
‚Øà 18:09:18.412 [vtbot-debug] Transitions from /morph/two/ to /morph/three/
   18:09:18.416 [vtbot-debug] Event handler for astro:after-swap
   18:09:18.423 [vtbot-debug] resolve viewTransition.updateCallbackDone
   18:09:18.425 [vtbot-debug] reject viewTransition.ready with DOMException: Transition was aborted because of invalid state
   18:09:18.447 [vtbot-debug] Event handler for astro:page-load
   18:09:18.710 [vtbot-debug] resolve viewTransition.finished
```

### Event properties

The detailled view of the properties shows one line for each property of the event. When the value of a property changed since it was last reported, the old and the new value are shown.

```console x.txt {12,18}
‚ØÜ 18:09:18.025 [vtbot-debug] Properties of the astro:before-preparation event
   18:09:18.025 type: astro:before-preparation
   18:09:18.025 cancelable: true
   18:09:18.025 defaultPrevented: false
   18:09:18.025 from: http://localhost:4321/morph/two/
   18:09:18.025 to: http://localhost:4321/morph/three/
   18:09:18.026 direction: forward
   18:09:18.026 navigationType: traverse
   18:09:18.026 info: undefined
   18:09:18.027 newDocument: a1: v1 (18.24 kB)
   18:09:18.027 formData: undefined
   18:09:18.027 loader changed from function () { [native code] } to async () => {
		                  await originalLoader();
											if (event.navigationType !== "traverse") {    
										  ...
	 ...
   18:09:18.027 [vtbot-debug] before execution of loader()
   18:09:18.376 [vtbot-debug] newDocument changed from a1: v1 (18.24 kB) to a2: v2 (11.04 kB)
   18:09:18.376 [vtbot-debug] after execution of loader()
```	

### Transition groups

The `<VtBotDebug>` component logs the transition groups that participate in the transition. Beside the name of the transition group, the component shows the CSS selector that matches the elements on the current page and the target page of the navigation. `(nowhere)` is used as placeholder if the transition name does not appear on both pages. 

```console x.txt {5}
   18:09:18.412 [vtbot-debug] Transitions from /morph/two/ to /morph/three/
   18:09:18.413 [ transition] 1 "a21" from body > p > a --to-> (nowhere)
   18:09:18.413 [ transition] 2 "a22" from body > p:nth-of-type(2) > a --to-> (nowhere)
   18:09:18.413 [ transition] 3 "a23" from body > p:nth-of-type(2) > a:nth-of-type(2) --to-> (nowhere)
   18:09:18.414 [ transition] 4 "a24" from body > p:nth-of-type(4) > a --to-> html > body > h1
   18:09:18.414 [ transition] 5 "root" from html --to-> html
   18:09:18.414 [ transition] 6 "a31" from (nowhere) --to-> html > body > p:nth-of-type(3) > a
```

### View Transition promises

After the view transition got startet, the API provides three promises that can be used to wait for different stages of the transition. The `<VtBotDebug>` component logs when these promises are resolved or rejected. If rejected, the reason is also shown.


```console x.txt {1,2,4}
   18:09:18.423 [vtbot-debug] resolve viewTransition.updateCallbackDone
   18:09:18.425 [vtbot-debug] reject viewTransition.ready with DOMException: Transition was aborted because of invalid state
	 18:09:18.447 [vtbot-debug] Event handler for astro:page-load
   18:09:18.710 [vtbot-debug] resolve viewTransition.finished
```


## Usage

The `<VtBotDebug>` component should be inserted as early as possible in the `<head>` of the page you want to investigate. 

```astro title="MyPage.astro" {3,7}
---
import { ViewTransitions } from 'astro:transitions';
import VtBotDebug from 'astro-vtbot/components/VtBotDebug.astro';
---
<html>
  <head>
    <VtBotDebug />
    <ViewTransitions />
    ...
  </head>
  ...
</html>
```
### Attributes

The `<VtBotDebug>` component supports three boolean properties:
|   Property | Effect |
|------------|---------|
| overlay| Redirect the output from the console to an on-screen overlay.|
| hideProperties | When `overlay` is used, hide the properties of the events to produce shorter logs.|
| production | Be active in production mode. Helpful when chasing bugs the do onl show up in production.|

Use these attributes on the `<VtBotDebug>` component like this:

```astro title="PageToDebug.astro" {3}
<html>
  <head>
    <VtBotDebug overlay hideProperties />
		<ViewTransitions />
  </head>
  ...
</html>
```
